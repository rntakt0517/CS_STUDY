# 교착 상태

---

### 교착 상태(Deadlock)란 무엇인가?

교착 상태, 혹은 데드락(Deadlock)은 여러 프로세스가 자원을 사용하려고 할 때, 각 프로세스가 다른 프로세스가 점유하고 있는 자원의 해제를 기다리면서 서로 무한히 기다리는 상태를 말함. 이는 마치 교차로에서 자동차들이 서로의 길을 막고 있어 누구도 움직일 수 없는 상황과 같음.

#### 교착 상태가 발생하는 이유

교착 상태가 발생하는 이유는 프로세스들이 서로 필요한 자원을 점유하고 있으면서 동시에 다른 프로세스가 점유하고 있는 자원을 기다리는 경우임. 이로 인해 아무런 프로세스도 필요한 자원을 얻지 못해 실행되지 못하고, 결국 시스템이 멈추게 됨.

#### 교착 상태의 고전적인 예: 식사하는 철학자 문제

교착 상태를 설명하기 위해 자주 사용되는 예시로 **식사하는 철학자 문제**가 있음.

- **상황 설명**:
  
  - 5명의 철학자가 원형 식탁에 앉아 있고, 각 철학자 사이에는 포크가 하나씩 있음.
  - 철학자가 식사를 하려면 양쪽의 포크가 모두 필요함.
  - 철학자는 왼쪽 포크를 집은 후, 오른쪽 포크를 집을 수 있을 때 식사를 시작함.
  - 만약 모든 철학자가 동시에 왼쪽 포크를 집고 오른쪽 포크를 기다린다면, 아무도 오른쪽 포크를 얻지 못해 식사가 불가능한 상황이 됨. 이는 바로 교착 상태임.

- **문제의 시사점**:
  
  - 철학자(프로세스)는 자원을 사용하는 주체이고, 포크는 자원임.
  - 자원을 사용하는 과정에서 교착 상태가 발생할 수 있으며, 이를 해결해야 시스템이 원활하게 운영될 수 있음.

#### 교착 상태를 시각적으로 표현하기: 자원 할당 그래프

교착 상태를 이해하고 분석하기 위해 **자원 할당 그래프**를 사용함.

- **자원 할당 그래프의 구성 요소**:
  
  - **프로세스**는 원(circle)으로 표현됨.
  - **자원 종류**는 사각형(square)으로 표현됨.
  - 자원의 개수는 사각형 내부의 점(dot)으로 표현됨.

- **그래프에서의 화살표 사용**:
  
  - 프로세스가 자원을 **점유**하고 있으면 자원에서 프로세스로 화살표가 그려짐.
  - 프로세스가 자원을 **기다리고** 있으면 프로세스에서 자원으로 화살표가 그려짐.

- **교착 상태의 그래프적 특징**:
  
  - 자원 할당 그래프에서 **원의 형태**로 자원이 할당되어 있으면 교착 상태가 발생할 수 있는 상황을 나타냄.

#### 교착 상태가 발생하는 4가지 조건

교착 상태가 발생하려면 다음의 4가지 조건이 모두 충족되어야 함:

1. **상호 배제 (Mutual Exclusion)**:
   
   - 자원은 한 번에 하나의 프로세스만 사용할 수 있음. 예를 들어, 하나의 프린터를 두 개의 프로세스가 동시에 사용할 수 없음.

2. **점유와 대기 (Hold and Wait)**:
   
   - 자원을 이미 점유한 프로세스가 다른 자원을 추가로 기다리는 상태를 의미함. 예를 들어, 프로세스 A는 자원 A를 점유하고 있으면서 자원 B를 기다리고, 프로세스 B는 자원 B를 점유하고 자원 A를 기다리는 경우임.

3. **비선점 (No Preemption)**:
   
   - 프로세스가 점유한 자원을 다른 프로세스가 강제로 뺏을 수 없음. 즉, 자원은 점유한 프로세스가 자발적으로 해제할 때까지 기다려야 함.

4. **원형 대기 (Circular Wait)**:
   
   - 각 프로세스가 다음 프로세스가 점유한 자원을 기다리는 형태로 원을 이루며 대기하는 상태를 의미함. 자원 할당 그래프가 원형 형태를 이루는 것이 특징임.

#### 교착 상태 해결 방법

교착 상태를 해결하는 방법으로는 크게 세 가지가 있음: **예방(Prevention), 회피(Avoidance), 검출 및 회복(Detection and Recovery)**.

1. **교착 상태 예방 (Prevention)**
   
   - 교착 상태 예방은 4가지 발생 조건 중 하나라도 발생하지 않도록 만드는 방법임.
     - **상호 배제 조건 제거**: 모든 자원을 공유하게 만듦. 그러나 이는 현실적으로 불가능함.
     - **점유와 대기 조건 제거**: 프로세스가 자원을 요청하기 전에 모든 자원을 한 번에 할당하거나, 자원을 점유한 상태에서 추가 자원을 요청하지 못하게 함. 하지만 자원 활용률이 떨어지는 문제가 발생할 수 있음.
     - **비선점 조건 제거**: 자원을 강제로 뺏을 수 있도록 만듦. 그러나 모든 자원이 선점 가능하지 않으며, 실제로도 어려운 방식임.
     - **원형 대기 조건 제거**: 자원에 번호를 부여하고, 프로세스가 자원을 요청할 때 오름차순으로만 요청하게 만듦. 이는 현실적이고 효과적인 방법이지만, 자원의 활용도가 달라질 수 있음.

2. **교착 상태 회피 (Avoidance)**
   
   - 교착 상태 회피는 자원을 할당하기 전에 교착 상태가 발생할 위험이 있는지를 검사하고, 안전한 경우에만 자원을 할당하는 방법임.
   - **은행원 알고리즘(Banker's Algorithm)** 이 대표적인 교착 상태 회피 알고리즘임. 프로세스가 자원을 요청할 때마다, 자원을 할당했을 때 시스템이 안전한 상태로 남는지를 검사함. 안전하다면 자원을 할당하고, 그렇지 않으면 자원의 할당을 보류함.
   - 회피 기법은 자원 할당 요청에 대해 지속적으로 검사해야 하기 때문에 오버헤드가 발생할 수 있음.

3. **교착 상태 검출 및 회복 (Detection and Recovery)**
   
   - 교착 상태가 발생한 후에 이를 검출하고, 해결하는 방법임.
   - **검출 방법**:
     - 자원 할당 그래프를 주기적으로 분석하여 교착 상태가 발생했는지 확인함. 교착 상태가 감지되면 특정 프로세스를 중단하거나, 자원을 회수하여 문제를 해결함.
   - **회복 방법**:
     - 교착 상태에 있는 프로세스를 종료하거나, 자원을 점유하고 있는 프로세스에서 자원을 강제로 회수함. 이는 시스템의 상태를 분석하고, 피해를 최소화할 수 있는 전략을 세워야 함.
